<html><body><p>Hey,<br><br>In your benchmark, the following loop:<br>    for i in range(num):<br>        os.write(fd, " " * num2)<br><br>Is not hoisted out by CPython (whereas I guess PyPy does hoist it).<br>Which means that the buffer written is basically allocated/freed upon each loop.<br><br>If you want to measure pure I/O performance (so let's say a zero-copy setting), it should be hoisted manually out of the loop for CPython, like this:<br><br>    payload = b" " * num2<br>    for i in range(num):<br>        os.write(fd, payload)<br><br>Then, the results go from:<br><br>fwrite 100 bytes, 1.93us per write<br>fwrite 1000 bytes, 2.57us per write<br>fwrite 10000 bytes, 6.73us per write<br>file_write 100 bytes, 0.99us per write<br>file_write 1000 bytes, 1.68us per write<br>file_write 10000 bytes, 4.71us per write<br><br><br>to<br><br>fwrite 100 bytes, 1.38us per write<br>fwrite 1000 bytes, 1.48us per write<br>fwrite 10000 bytes, 1.38us per write<br>file_write 100 bytes, 0.65us per write<br>file_write 1000 bytes, 0.96us per write<br>file_write 10000 bytes, 2.32us per write<br><br>Also, might be worth trying wth binary mode.<br><br>Anyway, keep up the great work!</p></body></html>