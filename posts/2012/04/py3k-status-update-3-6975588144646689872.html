<html><body><div class="document" id="py3k-status-update-3">This is the third status update about my work on the <a class="reference external" href="https://foss.heptapod.net/pypy/pypy/-/tree/branch/py3k">py3k branch</a>, which I can work on thanks to all of the people who <a class="reference external" href="http://morepypy.blogspot.com/2012/01/py3k-and-numpy-first-stage-thanks-to.html">donated</a> to the <a class="reference external" href="http://pypy.org/py3donate.html">py3k proposal</a>.<br>
<br>
A lot of work has been done during the last month: as usual, the list of changes is too big to be reported in a detalied way, so this is just a summary of what happened.<br>
<br>
One of the most active areas was killing old and deprecated features. In particular, we killed support for the <tt class="docutils literal">__cmp__</tt> special method and its counsins, the <tt class="docutils literal">cmp</tt> builtin function and keyword argument for <tt class="docutils literal">list.sort()</tt> and <tt class="docutils literal">sorted()</tt>.  Killing is easy, but then you have to fix all the places which breaks because of this, including all the types which relied on <tt class="docutils literal">__cmp__</tt> to be comparable,, fixing all the tests which tried to order objects which are no longer ordeable now, or implementing new behavior like forbidding calling <tt class="docutils literal">hash()</tt> on objects which implement <tt class="docutils literal">__eq__</tt> but not <tt class="docutils literal">__hash__</tt>.<br>
<br>
Among the other features, we killed lots of now-gone functions in the <tt class="docutils literal">operator</tt> module, the builtins <tt class="docutils literal">apply()</tt>, <tt class="docutils literal">reduce()</tt> and <tt class="docutils literal">buffer</tt>, and the <tt class="docutils literal">os.*</tt> functions to deal with temporary files, which has been deprecated in favour of the new <tt class="docutils literal">tempfile</tt> module.<br>
<br>
The other topic which can't miss in a py3k status update is, as usual, string-vs-unicode. At this round, we fixed bugs in string formatting (in particular to teach <tt class="docutils literal">format()</tt> to always use unicode strings) and various corner cases about when calling the (possibly overridden) <tt class="docutils literal">__str__</tt> method on subclasses of <tt class="docutils literal">str</tt>. Believe me, you don't want to know the precise rules :-).<br>
<br>
Other features which we worked on and fixed tests include, but are not limited to, <tt class="docutils literal">marshal</tt>, <tt class="docutils literal">hashlib</tt>, <tt class="docutils literal">zipimport</tt>, <tt class="docutils literal">_socket</tt> and <tt class="docutils literal">itertools</tt>, plus the habitual endless lists of tests which fail for shallow reasons such as the syntactic differences, <tt class="docutils literal">int</tt> vs <tt class="docutils literal">long</tt>, <tt class="docutils literal">range()</tt> vs <tt class="docutils literal"><span class="pre">list(range())</span></tt> etc. As a result, the number of failing tests <a class="reference external" href="http://buildbot.pypy.org/summary?category=linux32&amp;branch=py3k&amp;recentrev=53956:3c8ac35c653a">dropped</a> from 650 to 235: we are beginning to see the light at the end of the tunnel :-)<br>
<br>
Benjamin finished implementing Python 3 syntax. Most of it was small cleanups and tweaks to be compatible with CPython such as making <tt class="docutils literal">True</tt> and <tt class="docutils literal">False</tt> keywords and preventing <tt class="docutils literal">. . .</tt> (note spaces between dots) from being parsed as <tt class="docutils literal">Ellipsis</tt>. Larger syntax additions included keyword only arguments and function annotations.<br>
<br>
Finally, we did some RPython fixes, so that it is possible again to translate PyPy in the py3k branch. However, the resuling binary is a strange beast which mixes python 2 and python 3 semantics, so it is unusable for anything but <a class="reference external" href="http://paste.pocoo.org/show/577006/">showing friends how cool it is</a>.<br>
<br>
I would like to underline that I was not alone in doing all this work. In particular, a lot of people joined the PyPy sprint at Pycon and worked on the branch, as you can clearly see in this activity graph. I would like to thank all who helped!<br>
<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-XIrydp78nVs/T38-WyUX0PI/AAAAAAAAAQE/bLvx330NcAs/s1600/py3k-activity-march.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="150" src="http://1.bp.blogspot.com/-XIrydp78nVs/T38-WyUX0PI/AAAAAAAAAQE/bLvx330NcAs/s400/py3k-activity-march.png" width="400"></a></div><br>
cheers,<br>
Antonio and Benjamin</div></body></html>