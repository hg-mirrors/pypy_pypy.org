<html><body><div class="document" id="py3k-status-update-2">   <p>This is the second status update about my work on the <a class="reference external" href="https://bitbucket.org/pypy/pypy/src/py3k">py3k branch</a>, which I can work on thanks to all of the people who <a class="reference external" href="http://morepypy.blogspot.com/2012/01/py3k-and-numpy-first-stage-thanks-to.html">donated</a> to the <a class="reference external" href="http://pypy.org/py3donate.html">py3k proposal</a>.</p><p>Since my previous <a class="reference external" href="http://morepypy.blogspot.com/2012/02/py3k-status-update.html">status update</a>, things have improved a lot: first of all, I fixed the syntax of many more tests, which were failing on the branch because they used constructs which are no longer valid in Python 3, such as <tt class="docutils literal">u''</tt> strings, the <tt class="docutils literal">print</tt> statement or the old <tt class="docutils literal">except Exception, e</tt> syntax.  I have to say that this work is tedious and not very rewarding, but it has to be done anyway, so that the real failures can stand up.</p><p>Then, I spent most of the rest of the time by killing features which are present in Python 2 and are gone in Python 3.</p><p>Some of them were easy and mechnical: for example, I removed all the function attributes such as <tt class="docutils literal">func_code</tt> and <tt class="docutils literal">func_closure</tt>, which has been renamed to <tt class="docutils literal">__code__</tt> and <tt class="docutils literal">__closure__</tt>, and then I had to find and fix all the places which still expected the old ones.</p><p>Some were trickier: I removed support for the <tt class="docutils literal">cmp</tt> function and the <tt class="docutils literal">__cmp__</tt> special method, but this also meant that I had to fix a few types which relied on it to be comparable (for example, did you know that the cells contained in <tt class="docutils literal">__closure__</tt> are comparable?). At the same time, I also removed the old behavior which in Python 2 allows us to compare arbitrary objects with <tt class="docutils literal">&lt;</tt>, <tt class="docutils literal">&gt;</tt> &amp; co.: in Python 3 the only comparisons allowed between incompatible types are <tt class="docutils literal">==</tt> and <tt class="docutils literal">!=</tt>.</p><p>Speaking of old special methods, <tt class="docutils literal">__hex__</tt> and <tt class="docutils literal">__oct__</tt> are gone as well (and I didn't even know about their existence before removing them :-))</p><p>But the most important breakthrough was the removal of the <tt class="docutils literal">_file</tt> module, containing the implementation of the <tt class="docutils literal">file</tt> type in Python 2, which is now gone since in Python 3 files are handled by the <tt class="docutils literal">_io</tt> module.  Killing the module was not straightforward, because some of the importing logic was tightly tied to the internal implementation of files, so it needed some refactoring. Finally, I had to fix the <tt class="docutils literal">marshal</tt> module to correctly detect text files vs. byte files.</p><p>Among these things, I fixed tons of smaller issues here and there. As a result, there are many fewer failing tests than a few weeks ago.  Obviously the number itself does not mean much, because sometimes fixing a single test takes hours, and some other times by changing one line one fixes tens of tests. But at the end, seeing it dropping from 999 to <a class="reference external" href="http://buildbot.pypy.org/summary?category=linux32&amp;branch=py3k&amp;recentrev=53071:411bb6d819b1">650</a> always is nice and rewarding :-).</p><p>The road for having a pypy3k is still long, but everything is going fine so far. Stay tuned for more updates!</p><p>cheers, Antonio</p></div></body></html>