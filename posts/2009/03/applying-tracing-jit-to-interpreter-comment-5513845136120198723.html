<html><body><p>Very nice. You might want to have a look at <a href="http://people.csail.mit.edu/gregs/dynamorio.html" rel="nofollow"> Sullivan, et al (2003) Dynamic Native Optimization of Interpreters</a>. They also identify the need to record not only the native PC but also the interpreter's virtual PC to identify useful trace heads. They provide three intrinsic functions (compared to your single <i>add_to_position_key</i>) to achieve this. Further, they provide three more intrinsics to support constant propagation.</p></body></html>