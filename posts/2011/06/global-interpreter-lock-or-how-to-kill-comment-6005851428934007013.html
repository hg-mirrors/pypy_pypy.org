<html><body><p>To address the anonymous question near the start of the comments, one way to detect commit collision is to copy a global generation counter at the start of your transaction, and then compare your stored copy to the current generation counter at commit time (after taking a lock), and if no one else has incremented the generation counter, you do so and complete your operation.<br><br>So transaction does:<br>  self.generation = global.generation<br><br>And commit does:<br>  if lock(global.lock):<br>    if self.generation == global.generation:<br>      global.generation += 1<br>      return True<br>  unlock(global.lock)<br>  return False</p></body></html>